!function(){var e=function(){try{return window.self!==window.top}catch(e){return!0}}();var r=null,t=null,a=null;function o(o){var n=$("<div/>");!function(e){if(0!=(SETTINGS.show_platforms&~(1<<SETTINGS.platform-1))){var r=$("<div/>").addClass("partnerLogin").appendTo(e);$("<p/>").appendTo(r).text(_("login_platform_garena_prompt"));var t=$("<div/>").addClass("partnerLink").appendTo(r);SETTINGS.platform!=PLATFORM_GARENA&&SETTINGS.show_platforms&1<<PLATFORM_GARENA-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-garena").appendTo(t).click((function(){changePlatform(PLATFORM_GARENA)})),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_FACEBOOK&&SETTINGS.show_platforms&1<<PLATFORM_FACEBOOK-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-facebook").appendTo(t).click(u),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_LINE&&SETTINGS.show_platforms&1<<PLATFORM_LINE-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-line").appendTo(t).click(c),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_VK&&SETTINGS.show_platforms&1<<PLATFORM_VK-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-vk").appendTo(t).click(s),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_GOOGLE&&SETTINGS.show_platforms&1<<PLATFORM_GOOGLE-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-google").appendTo(t).click(p),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_HUAWEI&&SETTINGS.show_platforms&1<<PLATFORM_HUAWEI-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-huawei").appendTo(t).click(l),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_APPLE&&SETTINGS.show_platforms&1<<PLATFORM_APPLE-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-apple").appendTo(t).click(d),"oauth_login"==SETTINGS.mode&&SETTINGS.platform!=PLATFORM_TWITTER&&SETTINGS.show_platforms&1<<PLATFORM_TWITTER-1&&$("<a/>",{href:"javascript:;"}).addClass("icon-twitter").appendTo(t).click(T)}}(n),$("<h2/>").addClass("title").text(_("login_header")).prependTo(n);var f=$("<form/>",{id:"login-form"}).addClass("loginForm").appendTo(n),m=!1,S=$("<div/>",{id:"line-country",style:"display: none;"}).addClass("line").appendTo(f),h=$("<select/>",{id:"sso_login_form_select_country",name:"select_country"}).addClass("country").appendTo(S);for(i in COUNTRY_LIST){var E=$("<option/>",{value:COUNTRY_LIST[i].code,"data-country-code":COUNTRY_LIST[i].pcode}),g=COUNTRY_LIST[i].name+" ";COUNTRY_LIST[i].hasOwnProperty("lname")&&(g=g+"("+COUNTRY_LIST[i].lname+"‎) "),$("<p/>").text(g).appendTo(E),h.append(E)}var R=$("<div/>",{id:"line-account"}).addClass("line").appendTo(f),v=$("<span/>",{id:"sso_login_form_country_code",style:"display: none;"}).addClass("country-code").appendTo(R);h.change((function(){var e=$(this).find(":selected");v.text("+"+e.data("country-code"))})),h.val(SETTINGS.country).change();var O=$("<input/>",{id:"sso_login_form_account",name:"username",type:"text",placeholder:_("login_form_account_prompt"),autocorrect:"off",autocapitalize:"off"}).appendTo(R);SETTINGS.test&&"vi"==SETTINGS.language&&/android/i.test(navigator.userAgent)&&O.attr("placeholder",_("login_form_account_prompt_vi"));var I=$("<input/>",{id:"sso_login_form_password",name:"password",type:"password",autocomplete:"on",placeholder:_("login_form_password_prompt")}).appendTo($("<div/>",{id:"line-password"}).addClass("line").appendTo(f)),w=$("<div/>",{class:"line clearfix",id:"sso_captcha_wrap"}).appendTo(f),G=$("<div/>",{id:"line-captcha",class:"sso_captcha"}).appendTo(w),A=$("<div/>",{id:"sso_captcha_image",class:"clearfix sso_captcha"}).appendTo(w);$("<img/>").appendTo($("<span/>",{class:"code fl"}).appendTo(A)),$("<a/>",{href:"javascript:;",class:"refresh fl"}).text(_("refresh_captcha")).appendTo(A).click(refreshCaptcha),G.hide(),A.hide(),r=initCaptchaDialog("login_captcha_dialog",f);var L,P,C,b,y=$("<button/>",{id:"confirm-btn",name:"login",type:"submit",value:_("login_form_button_login"),onclick:"javascript:return false;"}).text("Đăng Nhập Ngay").addClass("btn").appendTo($("<div/>",{id:"line-btn",class:"line btnLine"}).appendTo(f)),k=($("<span/>").text(_("sso_login_divider_text")).appendTo($("<div/>",{class:"divider"}).appendTo(f)),$("<input/>",{id:"sso_login_link_register",name:"register",type:"button",value:_("sso_login_link_register_text"),onclick:"javascript:return false;"}).addClass("btn").addClass("black").appendTo($("<div/>",{id:"line-btn",class:"line btnLine"}).appendTo(f))),U=$("<div/>").addClass("linkLine").appendTo(n),q=$("<a/>",{id:"sso_login_link_forget_password",text:_("sso_login_link_forget_password_text"),href:"javascript:;"}).addClass("sec").appendTo(U),F=getRequestParam("username");function M(){var e=O.val();/^\d{6,15}$/.test(e)?(m=!0,S.show(),v.show(),O.addClass("mobile-number")):(m=!1,S.hide(),v.hide(),O.removeClass("mobile-number"))}function H(){let e;M(),e=m?v.text()+O.val():O.val();var r=I.val();if(e.length<=0)return showError(_("login_error_account_empty"),$("#line-account")),void O.focus();if(r.length<=0)return showError(_("login_error_password_empty"),$("#line-password")),void I.focus();r=CryptoJS.AES.encrypt(r,SETTINGS.recaptcha_site_key).toString();let o={account:e,password:CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(r)).toString()};if($(".sso_captcha").is(":visible")){var n=G.find("input").val();if(null==n||n.length<=0)return showError(_("login_error_captcha_empty"),$("#sso_captcha_wrap")),void refreshCaptcha();o.captcha_key=captcha_key,o.captcha=n}null!==t&&(o.recaptcha_token=t,t=null),null!=a&&(o.shopee_captcha_token=a,a=null),y.html('<img src="/sso/loader.gif" style="height: inherit;width: 50px;"> Đăng Nhập Ngay'),y.attr("disabled",!0),requestJson("",o,N.preloginCallback,"POST")}null!=F&&(O.val(F),I.focus()),showContent(n,o),k.click((function(){var r=getRequestParams();if(e){var t=SSO_URL_UI_REGISTER;"locale"in r&&(t+="?locale="+r.locale),window.open(t,"_blank")}else{var a={redirect_uri:window.location.href};"display"in r&&(a.display=r.display),"locale"in r&&(a.locale=r.locale),redirect(SSO_URL_UI_REGISTER,a)}})),q.click((function(){SETTINGS.test?window.open(ACCOUNT_CENTER_RECOVERY_TEST_URL,"_blank"):window.open(ACCOUNT_CENTER_RECOVERY_URL,"_blank")})),O.blur(M),$(".content").keypress((function(e){if(e.which==KEY_CODE_ENTER){if(e.preventDefault(),y.attr("disabled"))return;if(O.val().length<=0)return O.is(":focus")&&showError(_("login_error_account_empty"),$("#line-account")),void O.focus();if(I.val().length<=0)return I.is(":focus")&&showError(_("login_error_password_empty"),$("#line-password")),void I.focus();H()}})),y.click(H),O.focus(),SETTINGS.iframe&&(L=document.body,P=function(e){var r={height:e};parent.postMessage(JSON.stringify(r),SETTINGS.target_origin)},b=L.clientHeight,P(b),function e(){C=L.clientHeight,b!=C&&P(C),b=C,L.onElementHeightChangeTimer&&clearTimeout(L.onElementHeightChangeTimer),L.onElementHeightChangeTimer=setTimeout(e,100)}())}function n(e,r,t,a){a=a||!1;for(var o=e.split("?"),n=o[0],i=1;i<o.length;i++){var s=o[i],_="",c="",p=!1;if(s)for(var l=s.split("&"),d=0;d<l.length;d++)l[d].split("=")[0]!=r?(_+=c+l[d],c="&"):(p=!0,""!=t&&(_+=c+r+"="+t,c="&"));a&&!p&&(_+=c+r+"="+t),n=n+"?"+_}return n}function s(){var e={};e.client_id=SETTINGS.vk_client_id,e.display="page",e.redirect_uri=n(window.location.href.split("#")[0],"platform",PLATFORM_VK,!0),e.scope="friends,offline",e.response_type="token",e.v="5.69",redirect(VK_OAUTH_URL,e)}function c(){var e={response_type:"code"};e.client_id=SETTINGS.line_client_id,e.redirect_uri=n(window.location.href.split("#")[0],"platform",PLATFORM_LINE,!0),e.state=SETTINGS.line_state,e.scope="profile openid",redirect(LINE_OAUTH_URL,e)}function p(){var e=SETTINGS.google_client_id,r=window.location.href.split("?")[0]+"/google";(n=getRequestParams()).platform=PLATFORM_GOOGLE;var t="";for(var a in n)"redirect_uri"==a&&(n[a]=encodeURIComponent(n[a])),t+="&"+a+"="+n[a];var o=document.createElement("form");o.setAttribute("method","GET"),o.setAttribute("action",GOOGLE_OAUTH_URL);var n={client_id:e,redirect_uri:r,response_type:"code",scope:"profile email openid",state:encodeURIComponent(t)};for(var i in n){var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name",i),s.setAttribute("value",n[i]),o.appendChild(s)}document.body.appendChild(o),o.submit()}function l(){var e={};e.client_id=SETTINGS.huawei_app_id,e.redirect_uri=n(window.location.href.split("#")[0],"platform",PLATFORM_HUAWEI,!0),e.response_type="code",e.scope="https://www.huawei.com/auth/account/base.profile",redirect(HUAWEI_OAUTH_URL,e)}function d(){var e={};e.client_id=SETTINGS.apple_client_id,e.scope="name email",e.redirect_uri=window.location.href.split("?")[0]+"/apple",e.response_type="code id_token",e.response_mode="form_post";var r=getRequestParams();r.platform=PLATFORM_APPLE;var t="";for(var a in r)"redirect_uri"==a&&(r[a]=encodeURIComponent(r[a])),t+="&"+a+"="+r[a];e.state=SETTINGS.apple_state+"-"+encodeURIComponent(t),redirect(APPLE_OAUTH_URL,e)}function T(){var e={},r=getRequestParams();r.platform=PLATFORM_TWITTER;var t="";for(var a in r)"redirect_uri"==a&&(r[a]=encodeURIComponent(r[a])),t+="&"+a+"="+r[a];e.callback_uri=window.location.href.split("?")[0]+"?"+encodeURIComponent(t.substr(1)),requestJson(SSO_URL_OAUTH_TWITTER_REQUEST_TOKEN,e,(function(r){if(e={},"error"in r)e.error=r.error;else{if("twitter_request_token"in r)return e.oauth_token=r.twitter_request_token,void redirect(TWITTER_OAUTH_URL,e);e.error="error_unknown",redirect(getRequestParam("redirect_uri"),e)}}),"post")}function u(){var e=window.location.href.split("?")[0]+"/facebook";(o=getRequestParams()).platform=PLATFORM_FACEBOOK;var r="";for(var t in o)"redirect_uri"==t&&(o[t]=encodeURIComponent(o[t])),r+="&"+t+"="+o[t];var a=encodeURIComponent(r.substr(1)),o={client_id:SETTINGS.fb_app_id.toString(),redirect_uri:e,response_type:"token",scope:SETTINGS.fb_scope,state:a};redirect(FACEBOOK_OAUTH_URL,o)}function f(e){return params={},"error"in e?params.error=e.error:"access_token"in e?params.access_token=e.access_token:"code"in e?params.code=e.code:params.error="error_unknown",params}function m(){var e,r,t=getRequestFragment("access_token"),a=getRequestFragment("user_id");return!(!t||!a)&&(e=t,r=getRequestParam("redirect_uri"),requestJson(SSO_URL_OAUTH_TOKEN_VK_EXCHANGE,{response_type:SETTINGS.response_type,vk_access_token:e,client_id:SETTINGS.app_id,redirect_uri:r},(function(e){params=f(e);var t=getRequestParam("state");null!==t&&(params.state=t),redirect(r,params)}),"post"),!0)}function S(){var e,r=getRequestParam("code"),t=getRequestParam("error");return null!=r?(function(e){var r=getRequestParam("redirect_uri"),t=n(window.location.href.split("#")[0],"code","");t=function(e,r){for(var t=e.split("?"),a=t[0],o=1;o<t.length;o++){var n=t[o],i="",s="";if(n)for(var _=n.split("&"),c=!1,p=_.length-1;p>=0;p--)_[p].split("=")[0]!==r||c?(i=_[p]+s+i,s="&"):c=!0;a=a+"?"+i}return a}(t,"state");var a=getUrlParams(t);requestJson(SSO_URL_OAUTH_TOKEN_LINE_EXCHANGE,{response_type:SETTINGS.response_type,line_auth_code:e,client_id:SETTINGS.app_id,redirect_uri:r,line_redirect_uri:t},(function(e){params=f(e),"state"in a&&(params.state=a.state),redirect(r,params)}),"post")}(r),!0):null!=t&&SETTINGS.platform==PLATFORM_LINE&&(e="error_"+getRequestParam("error_reason"),redirect(getRequestParam("redirect_uri"),{error:e}),!0)}function h(){var e=getRequestParam("google_auth_code");return!!e&&(function(e){var r=getRequestParam("redirect_uri");requestJson(SSO_URL_OAUTH_TOKEN_GOOGLE_EXCHANGE,{response_type:SETTINGS.response_type,google_auth_code:e,client_id:SETTINGS.app_id,google_redirect_uri:window.location.href.split("?")[0]+"/google",redirect_uri:r},(function(e){params=f(e);var t=getRequestParam("state");null!==t&&(params.state=t),redirect(r,params)}),"post")}(e),!0)}function E(){var e,r,t=getRequestParam("authorization_code");return!!t&&(e=t,r=getRequestParam("redirect_uri"),requestJson(SSO_URL_OAUTH_TOKEN_HUAWEI_EXCHANGE,{response_type:SETTINGS.response_type,hw_auth_code:e,client_id:SETTINGS.app_id,huawei_redirect_uri:n(window.location.href.split("#")[0],"authorization_code",""),redirect_uri:r},(function(e){params=f(e);var t=getRequestParam("state");null!==t&&(params.state=t),redirect(r,params)}),"post"),!0)}function g(){var e=getRequestParam("apple_auth_code");return!!e&&(function(e){var r=getRequestParam("redirect_uri");requestJson(SSO_URL_OAUTH_TOKEN_APPLE_EXCHANGE_WEB,{response_type:SETTINGS.response_type,apple_auth_code:e,client_id:SETTINGS.app_id,redirect_uri:r},(function(e){params=f(e);var t=getRequestParam("state");null!==t&&(params.state=t),redirect(r,params)}),"post")}(e),!0)}function R(){var e=getRequestParam("oauth_token"),r=getRequestParam("oauth_verifier");return!(!e||!r)&&(function(e,r){var t=getRequestParam("redirect_uri");requestJson(SSO_URL_OAUTH_TOKEN_TWITTER_EXCHANGE,{response_type:SETTINGS.response_type,twitter_oauth_token:e,oauth_verifier:r,client_id:SETTINGS.app_id,redirect_uri:t},(function(e){params=f(e);var r=getRequestParam("state");null!==r&&(params.state=r),redirect(t,params)}),"post")}(e,r),!0)}function v(){var e,r,t,a=getRequestFragment("access_token"),o=getRequestParam("error");return null!=a?(r=a,t=getRequestParam("redirect_uri"),requestJson(SSO_URL_OAUTH_TOKEN_FACEBOOK_EXCHANGE,{response_type:SETTINGS.response_type,facebook_access_token:r,client_id:SETTINGS.app_id,redirect_uri:t},(function(e){params=f(e);var r=getRequestParam("state");null!==r&&(params.state=r),redirect(t,params)}),"post"),!0):null!=o&&SETTINGS.platform==PLATFORM_FACEBOOK&&(e="error_"+getRequestParam("error_reason"),redirect(getRequestParam("redirect_uri"),{error:e}),!0)}window.SSO_SERVER={};var N=window.SSO_SERVER;N.init=function(e){if(SETTINGS=e,"sso_login"==SETTINGS.mode||"oauth_login"==SETTINGS.mode){if(SETTINGS.platform==PLATFORM_LINE&&S())return;if(m())return;if(SETTINGS.platform==PLATFORM_GOOGLE&&h())return;if(SETTINGS.platform==PLATFORM_HUAWEI&&E())return;if(SETTINGS.platform==PLATFORM_APPLE&&g())return;if(SETTINGS.platform==PLATFORM_TWITTER&&R())return;if(v())return;switch(SETTINGS.platform){case PLATFORM_VK:s();break;case PLATFORM_LINE:c();break;case PLATFORM_GOOGLE:p();break;case PLATFORM_HUAWEI:l();break;case PLATFORM_FACEBOOK:u();break;case PLATFORM_APPLE:d();break;case PLATFORM_TWITTER:T();break;default:o(isMobile()?"mobile":"pc")}}else"oauth_grant"==SETTINGS.mode?showGrantPage(isMobile()?"mobile":"pc"):"register"==SETTINGS.mode&&showRegisterPage(isMobile()?"mobile":"pc")},N.preloginCallback=function(o,n){if("error"in o){if("error_require_captcha"==o.error)showCaptcha(),showError(_("login_"+o.error),$("#line-btn"));else if("error_captcha"==o.error)refreshCaptcha(),showError(_("login_error_captcha"),$("#sso_captcha_wrap"));else if("error_require_recaptcha_token"==o.error)renderRecaptcha("sso_recaptcha_wrap",(function(e){t=e}));else if("error_recaptcha_token"==o.error)renderRecaptcha("sso_recaptcha_wrap",(function(e){t=e})),showError(_("login_error_captcha"),$("#line-btn"));else if("error_require_shopee_captcha_token"==o.error)showShopeeCaptchaDialog(r,(function(e){a=e,hideCaptchaDialog(r)}));else if("error_shopee_captcha_token"==o.error)showShopeeCaptchaDialog(r,(function(e){a=e,hideCaptchaDialog(r)})),showError(_("login_error_captcha"),$("#line-btn"));else if("error_security_ban"==o.error){var i=7;showError(_("login_error_security_ban",{second:i}),$("#line-btn"));var s=setInterval((function(){i--,showError(_("login_error_security_ban",{second:i}),$("#line-btn")),i<=0&&(clearInterval(s),e?(window.open(o.redirect_uri,"_blank"),clearMessage("#line-btn")):redirect(o.redirect_uri))}),1e3)}else showError(_("login_"+o.error),$("#line-btn"));return $("#confirm-btn").html("Đăng Nhập Ngay"),void $("#confirm-btn").attr("disabled",!1)}if("url"in o&&o.url)return $("#confirm-btn").html("Đăng Nhập Ngay"),$("#confirm-btn").attr("disabled",!1),void showError(_("beetalk_send_otp_error_otp_limit"),$("#line-btn"));"sso_login"==SETTINGS.mode&&(function(e){if(SETTINGS.iframe)return parent.postMessage(JSON.stringify(e),SETTINGS.target_origin),!0;return!1}(o)||("redirect_uri"in o?redirect(o.redirect_uri):($("#confirm-btn").html("Đăng Nhập Ngay"),$("#confirm-btn").attr("disabled",!1),showError(_("login_error_too_many_requests"),$("#line-btn")))))}}();